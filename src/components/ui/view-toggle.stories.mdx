import { Meta, Story, Canvas, ArgsTable, Description } from '@storybook/addon-docs';
import { ViewToggle } from './view-toggle';
import { Card, CardHeader, CardContent, CardTitle, CardDescription } from './card';
import { Badge } from './badge';

<Meta
  title="UI Components/ViewToggle"
  component={ViewToggle}
  decorators={[
    (Story) => (
      <div className="min-h-[200px] p-8 bg-background flex items-center justify-center">
        <Story />
      </div>
    ),
  ]}
  parameters={{
    docs: {
      description: {
        component: `
The ViewToggle component is a specialized toggle button group for switching between grid and list view modes.
It integrates with the view preference store for automatic persistence to localStorage.

## Features

- **Controlled & Uncontrolled** - Supports both usage patterns
- **Persistent Storage** - Automatically saves to localStorage (uncontrolled mode)
- **Keyboard Navigation** - Full keyboard support (Enter/Space)
- **Accessibility** - ARIA radiogroup pattern with proper labels
- **Customizable** - Three size variants and three visual styles
- **State Sync** - Seamless integration with Zustand store
- **Icons** - Grid and List icons from lucide-react

## Usage

Use ViewToggle for:
- Browse pages with grid/list view options
- Collection galleries
- Search results pages
- Recipe browsing interfaces
- Any content that benefits from multiple view modes
        `
      }
    }
  }}
  argTypes={{
    value: {
      description: 'Controlled value for the view mode',
      control: { type: 'select' },
      options: ['grid', 'list'],
    },
    defaultValue: {
      description: 'Default value for uncontrolled mode',
      control: { type: 'select' },
      options: ['grid', 'list'],
    },
    size: {
      control: { type: 'select' },
      options: ['sm', 'md', 'lg'],
      description: 'Size variant of the toggle',
      defaultValue: 'md'
    },
    variant: {
      control: { type: 'select' },
      options: ['default', 'outline', 'ghost'],
      description: 'Visual style variant',
      defaultValue: 'default'
    },
    disabled: {
      control: { type: 'boolean' },
      description: 'Whether the toggle is disabled',
      defaultValue: false
    }
  }}
/>

# ViewToggle

<Description of={ViewToggle} />

## Basic Usage (Uncontrolled)

The simplest usage - uses the view preference store automatically.

<Canvas>
  <Story name="Basic">
    {() => {
      return <ViewToggle />;
    }}
  </Story>
</Canvas>

## Controlled Mode

Full control over the value with the `value` and `onValueChange` props.

<Canvas>
  <Story name="Controlled">
    {() => {
      const [viewMode, setViewMode] = React.useState('grid');

      return (
        <div className="space-y-4">
          <ViewToggle value={viewMode} onValueChange={setViewMode} />
          <div className="text-sm text-muted-foreground text-center">
            Current mode: <span className="font-medium">{viewMode}</span>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## Size Variants

Three size options: small, medium (default), and large.

<Canvas>
  <Story name="Sizes">
    {() => {
      return (
        <div className="flex flex-col items-center gap-8">
          <div className="flex flex-col items-center gap-2">
            <ViewToggle size="sm" />
            <p className="text-xs text-muted-foreground">Small</p>
          </div>

          <div className="flex flex-col items-center gap-2">
            <ViewToggle size="md" />
            <p className="text-xs text-muted-foreground">Medium (Default)</p>
          </div>

          <div className="flex flex-col items-center gap-2">
            <ViewToggle size="lg" />
            <p className="text-xs text-muted-foreground">Large</p>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## Visual Variants

Three visual styles: default, outline, and ghost.

<Canvas>
  <Story name="Variants">
    {() => {
      return (
        <div className="flex flex-col items-center gap-8">
          <div className="flex flex-col items-center gap-2">
            <ViewToggle variant="default" />
            <p className="text-xs text-muted-foreground">Default</p>
          </div>

          <div className="flex flex-col items-center gap-2">
            <ViewToggle variant="outline" />
            <p className="text-xs text-muted-foreground">Outline</p>
          </div>

          <div className="flex flex-col items-center gap-2">
            <ViewToggle variant="ghost" />
            <p className="text-xs text-muted-foreground">Ghost</p>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## Disabled State

Toggle can be disabled to prevent user interaction.

<Canvas>
  <Story name="Disabled">
    {() => {
      return (
        <div className="flex flex-col items-center gap-8">
          <div className="flex flex-col items-center gap-2">
            <ViewToggle disabled defaultValue="grid" />
            <p className="text-xs text-muted-foreground">Disabled (Grid)</p>
          </div>

          <div className="flex flex-col items-center gap-2">
            <ViewToggle disabled defaultValue="list" />
            <p className="text-xs text-muted-foreground">Disabled (List)</p>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## With Default Value

Specify a default value for uncontrolled mode.

<Canvas>
  <Story name="Default Value">
    {() => {
      return (
        <div className="flex flex-col items-center gap-8">
          <div className="flex flex-col items-center gap-2">
            <ViewToggle defaultValue="grid" />
            <p className="text-xs text-muted-foreground">Defaults to Grid</p>
          </div>

          <div className="flex flex-col items-center gap-2">
            <ViewToggle defaultValue="list" />
            <p className="text-xs text-muted-foreground">Defaults to List</p>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## All Combinations

Showcasing size and variant combinations.

<Canvas>
  <Story name="All Combinations">
    {() => {
      return (
        <div className="space-y-8">
          {/* Default variant */}
          <div>
            <h3 className="mb-4 text-sm font-medium">Default Variant</h3>
            <div className="flex items-center gap-6">
              <ViewToggle size="sm" variant="default" />
              <ViewToggle size="md" variant="default" />
              <ViewToggle size="lg" variant="default" />
            </div>
          </div>

          {/* Outline variant */}
          <div>
            <h3 className="mb-4 text-sm font-medium">Outline Variant</h3>
            <div className="flex items-center gap-6">
              <ViewToggle size="sm" variant="outline" />
              <ViewToggle size="md" variant="outline" />
              <ViewToggle size="lg" variant="outline" />
            </div>
          </div>

          {/* Ghost variant */}
          <div>
            <h3 className="mb-4 text-sm font-medium">Ghost Variant</h3>
            <div className="flex items-center gap-6">
              <ViewToggle size="sm" variant="ghost" />
              <ViewToggle size="md" variant="ghost" />
              <ViewToggle size="lg" variant="ghost" />
            </div>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## In Context

Example of ViewToggle integrated into a typical browse page header.

<Canvas>
  <Story name="In Context">
    {() => {
      const [viewMode, setViewMode] = React.useState('grid');

      return (
        <div className="w-full max-w-4xl space-y-4">
          {/* Page Header */}
          <div className="flex items-center justify-between border-b pb-4">
            <div>
              <h2 className="text-2xl font-bold">Browse Recipes</h2>
              <p className="text-sm text-muted-foreground">
                Discover delicious recipes from around the world
              </p>
            </div>
            <ViewToggle value={viewMode} onValueChange={setViewMode} />
          </div>

          {/* Content Preview */}
          <div className="rounded-lg border bg-muted/20 p-8 text-center">
            <p className="text-sm text-muted-foreground">
              Content displayed in{' '}
              <span className="font-medium text-foreground">{viewMode}</span> view
            </p>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## Interactive Example

Full interactive example with persistent state.

<Canvas>
  <Story name="Interactive">
    {() => {
      const [viewMode, setViewMode] = React.useState('grid');
      const [size, setSize] = React.useState('md');
      const [variant, setVariant] = React.useState('default');
      const [disabled, setDisabled] = React.useState(false);

      return (
        <div className="w-full max-w-2xl space-y-6">
          {/* Controls */}
          <div className="rounded-lg border bg-card p-4 space-y-4">
            <h3 className="font-medium">Configuration</h3>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="mb-2 block text-sm font-medium">Size</label>
                <select
                  value={size}
                  onChange={(e) => setSize(e.target.value)}
                  className="w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                >
                  <option value="sm">Small</option>
                  <option value="md">Medium</option>
                  <option value="lg">Large</option>
                </select>
              </div>

              <div>
                <label className="mb-2 block text-sm font-medium">Variant</label>
                <select
                  value={variant}
                  onChange={(e) => setVariant(e.target.value)}
                  className="w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                >
                  <option value="default">Default</option>
                  <option value="outline">Outline</option>
                  <option value="ghost">Ghost</option>
                </select>
              </div>
            </div>

            <div className="flex items-center gap-2">
              <input
                type="checkbox"
                id="disabled-toggle"
                checked={disabled}
                onChange={(e) => setDisabled(e.target.checked)}
                className="h-4 w-4 rounded border-input"
              />
              <label htmlFor="disabled-toggle" className="text-sm font-medium">
                Disabled
              </label>
            </div>
          </div>

          {/* Toggle Preview */}
          <div className="rounded-lg border bg-card p-8">
            <div className="flex flex-col items-center gap-4">
              <ViewToggle
                value={viewMode}
                onValueChange={setViewMode}
                size={size}
                variant={variant}
                disabled={disabled}
              />
              <div className="text-center">
                <p className="text-sm text-muted-foreground">
                  Current mode: <span className="font-medium text-foreground">{viewMode}</span>
                </p>
                <p className="text-xs text-muted-foreground mt-1">
                  {size} • {variant} • {disabled ? 'disabled' : 'enabled'}
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

## Component API

<ArgsTable of={ViewToggle} />

## Accessibility Features

### Keyboard Navigation
- **Tab**: Navigate to the toggle group
- **Enter/Space**: Activate the focused button
- **Arrow Keys**: Navigate between grid and list buttons

### Screen Reader Support
- ARIA radiogroup pattern for proper semantics
- Each button has `role="radio"` with `aria-checked` state
- `aria-label` for the toggle group ("Switch view mode")
- Individual button labels ("Grid view", "List view")
- Screen reader only text for icon descriptions

### Focus Management
- Focus visible indicators on all buttons
- Logical tab order through controls
- Disabled state properly communicated (`tabIndex={-1}`)
- Focus ring with offset for visibility

## Design Guidelines

### When to Use
- **Browse Pages**: Recipe listings, collections, galleries
- **Search Results**: Toggle between grid and list views
- **Content Libraries**: User-generated content, media libraries
- **Product Catalogs**: E-commerce product display options

### When Not to Use
- **Single View Only**: Don't add if only one view makes sense
- **Mobile Only**: Consider hiding on mobile where space is limited
- **Complex Filters**: Use dedicated filter components instead
- **More Than 2 Options**: Use a dropdown or segmented control

### Best Practices
- **Placement**: Top-right of content area (standard convention)
- **Default Mode**: Grid is typically the default for visual content
- **Persistence**: Use uncontrolled mode for automatic persistence
- **Mobile**: Consider showing only one view on small screens
- **Context**: Place near other view controls (sort, filter)

## Integration with Store

The ViewToggle component integrates seamlessly with the view preference store:

```typescript
import { ViewToggle } from '@/components/ui/view-toggle';
import { useViewMode } from '@/stores/ui/view-preference-store';

// Uncontrolled - uses store automatically
<ViewToggle />

// Get current mode from store
const viewMode = useViewMode();

// Controlled - manage your own state
const [mode, setMode] = useState('grid');
<ViewToggle value={mode} onValueChange={setMode} />
```

## Performance Considerations

### Optimization Strategies
- Uses `React.useCallback` for all event handlers
- Minimal re-renders with proper memoization
- No expensive calculations or operations
- Efficient store subscriptions (only reads needed values)

### Bundle Impact
- Minimal overhead (~2KB gzipped)
- Tree-shakeable exports
- No heavy dependencies
- Uses lightweight Zustand store

## Implementation Notes

- Supports both controlled and uncontrolled modes
- Automatic localStorage persistence (uncontrolled mode)
- Full TypeScript type safety
- WCAG 2.1 AA compliant accessibility
- Keyboard navigation with Enter/Space
- Icons from lucide-react (Grid, List)
- Integrates with view-preference-store
- Compatible with all size and variant combinations
