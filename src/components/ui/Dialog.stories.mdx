import { Meta, StoryObj, Canvas, Controls, Primary, Source } from '@storybook/blocks';
import { useState } from 'react';
import { Trash2, Save, Share, Download, Copy, Globe, X } from 'lucide-react';
import {
  Dialog,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
  DialogButton,
  DialogIcon,
  ConfirmationDialog,
  RecipeConfirmationDialog,
  AlertDialog,
} from './dialog';

<Meta
  title="UI Components/Dialog"
  component={Dialog}
  parameters={{
    layout: 'centered',
    docs: {
      description: {
        component: `
A comprehensive dialog system built on Radix UI primitives. Provides accessible, customizable dialogs for confirmations, alerts, and recipe-specific actions.

## Features

- **Accessible**: Built on Radix UI with proper ARIA attributes
- **Animated**: Smooth enter/exit animations with backdrop blur
- **Flexible**: Multiple variants for different use cases
- **Recipe-specific**: Specialized components for recipe actions
- **Keyboard navigation**: Full keyboard support with focus management
- **Responsive**: Works across all screen sizes

## Component Variants

- \`Dialog\` - Base dialog components (primitive building blocks)
- \`ConfirmationDialog\` - Pre-built confirmation dialogs
- \`RecipeConfirmationDialog\` - Recipe-specific confirmation dialogs
- \`AlertDialog\` - Simple alert dialogs with single action

## Usage Guidelines

- Use ConfirmationDialog for destructive or important actions
- Use RecipeConfirmationDialog for recipe-specific operations
- Use AlertDialog for simple notifications or single-action confirmations
- Always provide clear, actionable text in titles and descriptions
        `,
      },
    },
  }}
  argTypes={{
    variant: {
      control: 'select',
      options: ['default', 'destructive', 'success', 'warning', 'info'],
      description: 'Dialog content styling variant',
    },
    size: {
      control: 'select',
      options: ['sm', 'default', 'lg', 'xl', 'full'],
      description: 'Dialog content size',
    },
  }}
/>

# Dialog

A versatile dialog system for confirmations, alerts, and recipe-specific actions.

<Primary />

<Controls />

## Basic Dialog

<Canvas>
  <Story name="Basic Dialog">
    {() => {
      const [open, setOpen] = useState(false);
      return (
        <>
          <DialogButton onClick={() => setOpen(true)}>
            Open Basic Dialog
          </DialogButton>
          <Dialog open={open} onOpenChange={setOpen}>
            <DialogContent>
              <DialogHeader>
                <DialogTitle>Basic Dialog</DialogTitle>
                <DialogDescription>
                  This is a basic dialog with standard content and close button.
                </DialogDescription>
              </DialogHeader>
              <DialogFooter>
                <DialogButton intent="secondary" onClick={() => setOpen(false)}>
                  Cancel
                </DialogButton>
                <DialogButton intent="primary" onClick={() => setOpen(false)}>
                  OK
                </DialogButton>
              </DialogFooter>
            </DialogContent>
          </Dialog>
        </>
      );
    }}
  </Story>
</Canvas>

## Dialog Variants

<Canvas>
  <Story name="Dialog Variants">
    {() => {
      const [currentDialog, setCurrentDialog] = useState(null);

      const variants = [
        { variant: 'default', label: 'Default', color: 'bg-blue-600' },
        { variant: 'destructive', label: 'Destructive', color: 'bg-red-600' },
        { variant: 'success', label: 'Success', color: 'bg-green-600' },
        { variant: 'warning', label: 'Warning', color: 'bg-yellow-600' },
        { variant: 'info', label: 'Info', color: 'bg-blue-500' },
      ];

      return (
        <div className="flex gap-2 flex-wrap">
          {variants.map((v) => (
            <div key={v.variant}>
              <DialogButton
                intent="secondary"
                className={v.color + ' text-white'}
                onClick={() => setCurrentDialog(v.variant)}
              >
                {v.label}
              </DialogButton>
              <Dialog
                open={currentDialog === v.variant}
                onOpenChange={(open) => !open && setCurrentDialog(null)}
              >
                <DialogContent variant={v.variant}>
                  <DialogHeader variant={v.variant}>
                    <DialogTitle variant={v.variant}>
                      {v.label} Dialog
                    </DialogTitle>
                    <DialogDescription variant={v.variant}>
                      This is a {v.variant} dialog variant with themed styling.
                    </DialogDescription>
                  </DialogHeader>
                  <DialogFooter>
                    <DialogButton
                      intent="secondary"
                      onClick={() => setCurrentDialog(null)}
                    >
                      Cancel
                    </DialogButton>
                    <DialogButton
                      intent={v.variant === 'destructive' ? 'destructive' : 'primary'}
                      onClick={() => setCurrentDialog(null)}
                    >
                      Confirm
                    </DialogButton>
                  </DialogFooter>
                </DialogContent>
              </Dialog>
            </div>
          ))}
        </div>
      );
    }}
  </Story>
</Canvas>

## Dialog Sizes

<Canvas>
  <Story name="Dialog Sizes">
    {() => {
      const [currentDialog, setCurrentDialog] = useState(null);

      const sizes = [
        { size: 'sm', label: 'Small' },
        { size: 'default', label: 'Default' },
        { size: 'lg', label: 'Large' },
        { size: 'xl', label: 'Extra Large' },
        { size: 'full', label: 'Full Screen' },
      ];

      return (
        <div className="flex gap-2 flex-wrap">
          {sizes.map((s) => (
            <div key={s.size}>
              <DialogButton
                intent="secondary"
                onClick={() => setCurrentDialog(s.size)}
              >
                {s.label}
              </DialogButton>
              <Dialog
                open={currentDialog === s.size}
                onOpenChange={(open) => !open && setCurrentDialog(null)}
              >
                <DialogContent size={s.size}>
                  <DialogHeader>
                    <DialogTitle>
                      {s.label} Dialog
                    </DialogTitle>
                    <DialogDescription>
                      This dialog demonstrates the {s.size} size variant. The content area adjusts to accommodate different amounts of content.
                    </DialogDescription>
                  </DialogHeader>
                  <div className="py-4">
                    <p className="text-sm text-gray-600">
                      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.
                    </p>
                  </div>
                  <DialogFooter>
                    <DialogButton
                      intent="secondary"
                      onClick={() => setCurrentDialog(null)}
                    >
                      Close
                    </DialogButton>
                  </DialogFooter>
                </DialogContent>
              </Dialog>
            </div>
          ))}
        </div>
      );
    }}
  </Story>
</Canvas>

## Confirmation Dialog

<Canvas>
  <Story name="Confirmation Dialog">
    {() => {
      const [currentDialog, setCurrentDialog] = useState(null);

      const confirmations = [
        {
          type: 'save',
          title: 'Save Changes',
          description: 'Do you want to save your changes?',
          icon: <Save className="w-6 h-6" />,
          color: 'bg-green-600'
        },
        {
          type: 'delete',
          title: 'Delete Item',
          description: 'This action cannot be undone.',
          icon: <Trash2 className="w-6 h-6" />,
          color: 'bg-red-600'
        },
        {
          type: 'discard',
          title: 'Discard Changes',
          description: 'Your unsaved changes will be lost.',
          icon: <X className="w-6 h-6" />,
          color: 'bg-yellow-600'
        },
        {
          type: 'publish',
          title: 'Publish Content',
          description: 'Make this content public?',
          icon: <Globe className="w-6 h-6" />,
          color: 'bg-blue-600'
        },
      ];

      return (
        <div className="flex gap-2 flex-wrap">
          {confirmations.map((c) => (
            <div key={c.type}>
              <DialogButton
                intent="secondary"
                className={c.color + ' text-white'}
                onClick={() => setCurrentDialog(c.type)}
              >
                {c.title}
              </DialogButton>
              <ConfirmationDialog
                open={currentDialog === c.type}
                onOpenChange={(open) => !open && setCurrentDialog(null)}
                title={c.title}
                description={c.description}
                icon={c.icon}
                type={c.type}
                onConfirm={() => {
                  alert(\`\${c.title} confirmed!\`);
                  setCurrentDialog(null);
                }}
                onCancel={() => setCurrentDialog(null)}
              />
            </div>
          ))}
        </div>
      );
    }}
  </Story>
</Canvas>

## Recipe Confirmation Dialogs

<Canvas>
  <Story name="Recipe Confirmation Dialogs">
    {() => {
      const [currentDialog, setCurrentDialog] = useState(null);

      const recipeActions = [
        { action: 'delete-recipe', label: 'Delete Recipe', color: 'bg-red-600' },
        { action: 'save-recipe', label: 'Save Recipe', color: 'bg-green-600' },
        { action: 'publish-recipe', label: 'Publish Recipe', color: 'bg-blue-600' },
        { action: 'share-recipe', label: 'Share Recipe', color: 'bg-purple-600' },
        { action: 'export-recipe', label: 'Export Recipe', color: 'bg-orange-600' },
        { action: 'duplicate-recipe', label: 'Duplicate Recipe', color: 'bg-indigo-600' },
      ];

      return (
        <div className="flex gap-2 flex-wrap">
          {recipeActions.map((action) => (
            <div key={action.action}>
              <DialogButton
                intent="secondary"
                className={action.color + ' text-white'}
                onClick={() => setCurrentDialog(action.action)}
              >
                {action.label}
              </DialogButton>
              <RecipeConfirmationDialog
                open={currentDialog === action.action}
                onOpenChange={(open) => !open && setCurrentDialog(null)}
                action={action.action}
                recipeName="Chocolate Chip Cookies"
                onConfirm={() => {
                  alert(\`\${action.label} confirmed!\`);
                  setCurrentDialog(null);
                }}
                onCancel={() => setCurrentDialog(null)}
              />
            </div>
          ))}
        </div>
      );
    }}
  </Story>
</Canvas>

## Alert Dialog

<Canvas>
  <Story name="Alert Dialog">
    {() => {
      const [currentAlert, setCurrentAlert] = useState(null);

      const alerts = [
        { variant: 'default', title: 'Information', description: 'This is an informational alert.' },
        { variant: 'success', title: 'Success!', description: 'Operation completed successfully.' },
        { variant: 'warning', title: 'Warning', description: 'Please review before proceeding.' },
        { variant: 'destructive', title: 'Error', description: 'Something went wrong.' },
      ];

      return (
        <div className="flex gap-2 flex-wrap">
          {alerts.map((alert) => (
            <div key={alert.variant}>
              <DialogButton
                intent="secondary"
                onClick={() => setCurrentAlert(alert.variant)}
              >
                {alert.title}
              </DialogButton>
              <AlertDialog
                open={currentAlert === alert.variant}
                onOpenChange={(open) => !open && setCurrentAlert(null)}
                title={alert.title}
                description={alert.description}
                variant={alert.variant}
                onAction={() => setCurrentAlert(null)}
              />
            </div>
          ))}
        </div>
      );
    }}
  </Story>
</Canvas>

## Dialog with Icons

<Canvas>
  <Story name="Dialog with Icons">
    {() => {
      const [open, setOpen] = useState(false);

      return (
        <>
          <DialogButton onClick={() => setOpen(true)}>
            Open Dialog with Icons
          </DialogButton>
          <Dialog open={open} onOpenChange={setOpen}>
            <DialogContent>
              <DialogHeader>
                <DialogIcon variant="warning" className="mb-4">
                  <Trash2 className="w-6 h-6" />
                </DialogIcon>
                <DialogTitle>Delete Confirmation</DialogTitle>
                <DialogDescription>
                  Are you sure you want to delete this item? This action cannot be undone.
                </DialogDescription>
              </DialogHeader>
              <DialogFooter>
                <DialogButton intent="secondary" onClick={() => setOpen(false)}>
                  Cancel
                </DialogButton>
                <DialogButton intent="destructive" onClick={() => setOpen(false)}>
                  Delete
                </DialogButton>
              </DialogFooter>
            </DialogContent>
          </Dialog>
        </>
      );
    }}
  </Story>
</Canvas>

## Loading States

<Canvas>
  <Story name="Loading States">
    {() => {
      const [open, setOpen] = useState(false);
      const [isLoading, setIsLoading] = useState(false);

      const handleConfirm = () => {
        setIsLoading(true);
        setTimeout(() => {
          setIsLoading(false);
          setOpen(false);
          alert('Action completed!');
        }, 2000);
      };

      return (
        <>
          <DialogButton onClick={() => setOpen(true)}>
            Dialog with Loading
          </DialogButton>
          <ConfirmationDialog
            open={open}
            onOpenChange={setOpen}
            title="Processing Request"
            description="This action may take a few moments to complete."
            confirmText="Process"
            isLoading={isLoading}
            onConfirm={handleConfirm}
            onCancel={() => setOpen(false)}
          />
        </>
      );
    }}
  </Story>
</Canvas>

## Accessibility Features

<Canvas>
  <Story name="Accessibility Demo">
    {() => {
      const [open, setOpen] = useState(false);

      return (
        <div className="space-y-4">
          <div className="p-4 bg-blue-50 rounded-lg">
            <h3 className="font-semibold mb-2">Accessibility Features:</h3>
            <ul className="text-sm space-y-1">
              <li>• Focus management and trap</li>
              <li>• Keyboard navigation (Tab, Escape, Enter)</li>
              <li>• ARIA attributes and roles</li>
              <li>• Screen reader announcements</li>
              <li>• High contrast focus indicators</li>
            </ul>
          </div>

          <DialogButton onClick={() => setOpen(true)}>
            Test Accessibility
          </DialogButton>

          <Dialog open={open} onOpenChange={setOpen}>
            <DialogContent>
              <DialogHeader>
                <DialogTitle>Accessibility Test</DialogTitle>
                <DialogDescription>
                  Try navigating this dialog with your keyboard:
                  <br />• Tab to move between elements
                  <br />• Enter/Space to activate buttons
                  <br />• Escape to close the dialog
                </DialogDescription>
              </DialogHeader>
              <div className="py-4 space-y-2">
                <DialogButton intent="secondary" size="sm">
                  Focusable Button 1
                </DialogButton>
                <DialogButton intent="secondary" size="sm">
                  Focusable Button 2
                </DialogButton>
              </div>
              <DialogFooter>
                <DialogButton intent="secondary" onClick={() => setOpen(false)}>
                  Cancel
                </DialogButton>
                <DialogButton intent="primary" onClick={() => setOpen(false)}>
                  Confirm
                </DialogButton>
              </DialogFooter>
            </DialogContent>
          </Dialog>
        </div>
      );
    }}
  </Story>
</Canvas>

## Best Practices

### Do's
- ✅ Use clear, actionable titles and descriptions
- ✅ Provide appropriate confirmation buttons for the action
- ✅ Use RecipeConfirmationDialog for recipe-specific actions
- ✅ Include icons to provide visual context
- ✅ Handle loading states for async operations
- ✅ Test keyboard navigation and screen readers

### Don'ts
- ❌ Don't use dialogs for non-critical information
- ❌ Don't create deeply nested dialog chains
- ❌ Don't ignore loading states for slow operations
- ❌ Don't use vague button text like "OK" or "Submit"
- ❌ Don't forget to handle the escape key

### When to Use Each Variant

**ConfirmationDialog**: General confirmations, destructive actions, save operations
**RecipeConfirmationDialog**: Recipe-specific actions with contextual styling
**AlertDialog**: Simple notifications, error messages, single-action confirmations
**Custom Dialog**: Complex forms, multi-step workflows, custom content layouts

<Source
  language="tsx"
  code={\`
// Basic confirmation
<ConfirmationDialog
  open={open}
  onOpenChange={setOpen}
  title="Delete Item"
  description="This action cannot be undone."
  type="delete"
  onConfirm={handleDelete}
/>

// Recipe-specific confirmation
<RecipeConfirmationDialog
  open={open}
  onOpenChange={setOpen}
  action="delete-recipe"
  recipeName="Chocolate Chip Cookies"
  onConfirm={handleDeleteRecipe}
/>

// Custom dialog
<Dialog open={open} onOpenChange={setOpen}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>Custom Dialog</DialogTitle>
    </DialogHeader>
    {/* Custom content */}
    <DialogFooter>
      <DialogButton onClick={handleAction}>
        Action
      </DialogButton>
    </DialogFooter>
  </DialogContent>
</Dialog>
\`}
/>
