import { Meta, Story, Canvas, ArgsTable, Description } from '@storybook/addon-docs';
import { LayoutProvider, useLayoutContext, LayoutErrorBoundary } from './layout-provider';

<Meta
  title="Layout Components/LayoutProvider"
  component={LayoutProvider}
  parameters={{
    docs: {
      description: {
        component: `
The LayoutProvider component provides layout context for managing layout variants,
sidebar visibility, footer visibility, and sub-navigation throughout the application.

## Features

- **Layout Variant Management**: Switch between default, focused, and minimal layouts
- **Visibility Control**: Manage sidebar and footer visibility independently
- **Sub-Navigation Context**: Automatically provide contextual navigation
- **Error Boundary**: Built-in error protection for layout components
- **Store Integration**: Seamless integration with navigation and layout stores

## Usage

The LayoutProvider is typically used at the application root level or around
specific page sections that need layout control. It provides context that
child components can access through the useLayoutContext hook.

## Context Values

The provider makes the following values available to child components:
- Current layout variant
- Sidebar and footer visibility state
- Sub-navigation items for the current route
- Functions to update layout state

## Error Handling

The provider includes built-in error boundary protection that catches
layout-related errors and provides a fallback UI with recovery options.
        `
      }
    }
  }}
  argTypes={{
    variant: {
      control: { type: 'select' },
      options: ['default', 'focused', 'minimal'],
      description: 'Default layout variant',
      defaultValue: 'default'
    },
    defaultShowSidebar: {
      control: { type: 'boolean' },
      description: 'Whether to show sidebar by default',
      defaultValue: true
    },
    defaultShowFooter: {
      control: { type: 'boolean' },
      description: 'Whether to show footer by default',
      defaultValue: true
    }
  }}
/>

# LayoutProvider

<Description of={LayoutProvider} />

## Basic Usage

<Canvas>
  <Story name="Basic">
    {() => {
      const TestComponent = () => {
        const {
          variant,
          showSidebar,
          showFooter,
          subNavigation,
          setVariant,
          toggleSidebar,
          toggleFooter
        } = useLayoutContext();

        return (
          <div className="p-6 space-y-4 border rounded-lg bg-card">
            <div className="space-y-2">
              <h3 className="text-lg font-semibold">Layout Context Values</h3>
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <strong>Variant:</strong> {variant}
                </div>
                <div>
                  <strong>Show Sidebar:</strong> {showSidebar.toString()}
                </div>
                <div>
                  <strong>Show Footer:</strong> {showFooter.toString()}
                </div>
                <div>
                  <strong>Sub-Navigation Items:</strong> {subNavigation.length}
                </div>
              </div>
            </div>

            <div className="space-y-3">
              <h4 className="font-medium">Controls</h4>
              <div className="flex flex-wrap gap-2">
                <button
                  onClick={() => setVariant('default')}
                  className="px-3 py-1 text-xs rounded bg-primary text-primary-foreground hover:bg-primary/90"
                >
                  Default
                </button>
                <button
                  onClick={() => setVariant('focused')}
                  className="px-3 py-1 text-xs rounded bg-primary text-primary-foreground hover:bg-primary/90"
                >
                  Focused
                </button>
                <button
                  onClick={() => setVariant('minimal')}
                  className="px-3 py-1 text-xs rounded bg-primary text-primary-foreground hover:bg-primary/90"
                >
                  Minimal
                </button>
                <button
                  onClick={toggleSidebar}
                  className="px-3 py-1 text-xs rounded border hover:bg-muted"
                >
                  Toggle Sidebar
                </button>
                <button
                  onClick={toggleFooter}
                  className="px-3 py-1 text-xs rounded border hover:bg-muted"
                >
                  Toggle Footer
                </button>
              </div>
            </div>
          </div>
        );
      };

      return (
        <LayoutProvider>
          <TestComponent />
        </LayoutProvider>
      );
    }}
  </Story>
</Canvas>

## Layout Variants

<Canvas>
  <Story name="Variants">
    {() => {
      const VariantDemo = ({ variant, title, description }) => {
        const TestComponent = () => {
          const context = useLayoutContext();
          return (
            <div className="p-4 border rounded-lg bg-card">
              <h4 className="font-semibold mb-2">{title}</h4>
              <p className="text-sm text-muted-foreground mb-3">{description}</p>
              <div className="text-xs space-y-1">
                <div>Variant: <code>{context.variant}</code></div>
                <div>Sidebar: <code>{context.showSidebar.toString()}</code></div>
                <div>Footer: <code>{context.showFooter.toString()}</code></div>
              </div>
            </div>
          );
        };

        return (
          <LayoutProvider variant={variant}>
            <TestComponent />
          </LayoutProvider>
        );
      };

      return (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <VariantDemo
            variant="default"
            title="Default Layout"
            description="Full layout with sidebar and footer"
          />
          <VariantDemo
            variant="focused"
            title="Focused Layout"
            description="Content-focused without sidebar"
          />
          <VariantDemo
            variant="minimal"
            title="Minimal Layout"
            description="Bare essentials only"
          />
        </div>
      );
    }}
  </Story>
</Canvas>

## Error Boundary

<Canvas>
  <Story name="Error Boundary">
    {() => {
      const ErrorComponent = ({ shouldThrow = false }) => {
        if (shouldThrow) {
          throw new Error('Demo error for testing error boundary');
        }
        return (
          <div className="p-4 border rounded-lg bg-card">
            <h3 className="font-semibold text-green-600 mb-2">âœ“ No Error</h3>
            <p className="text-sm text-muted-foreground">
              This component is working normally. The error boundary is ready
              to catch any layout-related errors that might occur.
            </p>
          </div>
        );
      };

      const [showError, setShowError] = React.useState(false);

      return (
        <div className="space-y-4">
          <div className="flex gap-2">
            <button
              onClick={() => setShowError(false)}
              className="px-3 py-1 text-sm rounded bg-green-600 text-white hover:bg-green-700"
            >
              Show Normal
            </button>
            <button
              onClick={() => setShowError(true)}
              className="px-3 py-1 text-sm rounded bg-red-600 text-white hover:bg-red-700"
            >
              Trigger Error
            </button>
          </div>

          <LayoutErrorBoundary>
            <ErrorComponent shouldThrow={showError} />
          </LayoutErrorBoundary>
        </div>
      );
    }}
  </Story>
</Canvas>

## Custom Defaults

<Canvas>
  <Story name="Custom Defaults">
    {() => {
      const TestComponent = () => {
        const context = useLayoutContext();
        return (
          <div className="p-4 border rounded-lg bg-card">
            <h3 className="font-semibold mb-3">Custom Default Configuration</h3>
            <div className="text-sm space-y-1">
              <div>Initial Variant: <code>{context.variant}</code></div>
              <div>Initial Sidebar: <code>{context.showSidebar.toString()}</code></div>
              <div>Initial Footer: <code>{context.showFooter.toString()}</code></div>
            </div>
            <p className="text-xs text-muted-foreground mt-3">
              This provider was configured with custom default values:
              variant="focused", defaultShowSidebar=false, defaultShowFooter=true
            </p>
          </div>
        );
      };

      return (
        <LayoutProvider
          variant="focused"
          defaultShowSidebar={false}
          defaultShowFooter={true}
        >
          <TestComponent />
        </LayoutProvider>
      );
    }}
  </Story>
</Canvas>

## Hooks Demo

<Canvas>
  <Story name="Hooks">
    {() => {
      // Import the individual hooks for demonstration
      const {
        useLayoutVariant,
        useSidebarVisibility,
        useFooterVisibility,
        useLayoutSubNavigation
      } = require('./layout-hooks');

      const HooksDemo = () => {
        const variant = useLayoutVariant();
        const showSidebar = useSidebarVisibility();
        const showFooter = useFooterVisibility();
        const subNavigation = useLayoutSubNavigation();

        return (
          <div className="p-4 border rounded-lg bg-card">
            <h3 className="font-semibold mb-3">Individual Layout Hooks</h3>
            <div className="grid grid-cols-2 gap-4 text-sm">
              <div>
                <strong>useLayoutVariant():</strong>
                <br />
                <code className="text-xs">{variant}</code>
              </div>
              <div>
                <strong>useSidebarVisibility():</strong>
                <br />
                <code className="text-xs">{showSidebar.toString()}</code>
              </div>
              <div>
                <strong>useFooterVisibility():</strong>
                <br />
                <code className="text-xs">{showFooter.toString()}</code>
              </div>
              <div>
                <strong>useLayoutSubNavigation():</strong>
                <br />
                <code className="text-xs">{subNavigation.length} items</code>
              </div>
            </div>
            <p className="text-xs text-muted-foreground mt-3">
              These hooks provide convenient access to specific parts of the layout context
              without needing to use the full useLayoutContext hook.
            </p>
          </div>
        );
      };

      return (
        <LayoutProvider variant="default">
          <HooksDemo />
        </LayoutProvider>
      );
    }}
  </Story>
</Canvas>

## Nested Providers

<Canvas>
  <Story name="Nested Providers">
    {() => {
      const InnerComponent = ({ level }) => {
        const context = useLayoutContext();
        return (
          <div className="p-3 border rounded bg-card">
            <h4 className="font-medium text-sm mb-2">Level {level}</h4>
            <div className="text-xs space-y-1">
              <div>Variant: <code>{context.variant}</code></div>
              <div>Sidebar: <code>{context.showSidebar.toString()}</code></div>
            </div>
          </div>
        );
      };

      return (
        <div className="space-y-4">
          <p className="text-sm text-muted-foreground">
            Nested providers allow for different layout configurations at different
            levels of the component tree.
          </p>

          <LayoutProvider variant="default">
            <InnerComponent level={1} />

            <LayoutProvider variant="focused">
              <InnerComponent level={2} />

              <LayoutProvider variant="minimal">
                <InnerComponent level={3} />
              </LayoutProvider>
            </LayoutProvider>
          </LayoutProvider>
        </div>
      );
    }}
  </Story>
</Canvas>

## Interactive Example

<Canvas>
  <Story name="Interactive">
    {(args) => {
      const TestComponent = () => {
        const context = useLayoutContext();

        return (
          <div className="p-6 space-y-6 border rounded-lg bg-card">
            <div>
              <h3 className="text-lg font-semibold mb-3">Interactive Layout Provider</h3>
              <p className="text-sm text-muted-foreground">
                Use the controls panel to modify the provider settings and see
                how they affect the layout context values.
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <h4 className="font-medium mb-2">Current Values</h4>
                <div className="space-y-1 text-sm">
                  <div className="flex justify-between">
                    <span>Variant:</span>
                    <code>{context.variant}</code>
                  </div>
                  <div className="flex justify-between">
                    <span>Show Sidebar:</span>
                    <code>{context.showSidebar.toString()}</code>
                  </div>
                  <div className="flex justify-between">
                    <span>Show Footer:</span>
                    <code>{context.showFooter.toString()}</code>
                  </div>
                  <div className="flex justify-between">
                    <span>Sub-Navigation:</span>
                    <code>{context.subNavigation.length} items</code>
                  </div>
                </div>
              </div>

              <div>
                <h4 className="font-medium mb-2">Actions</h4>
                <div className="space-y-2">
                  <div className="flex gap-1">
                    <button
                      onClick={() => context.setVariant('default')}
                      className="px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700"
                    >
                      Default
                    </button>
                    <button
                      onClick={() => context.setVariant('focused')}
                      className="px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700"
                    >
                      Focused
                    </button>
                    <button
                      onClick={() => context.setVariant('minimal')}
                      className="px-2 py-1 text-xs rounded bg-purple-600 text-white hover:bg-purple-700"
                    >
                      Minimal
                    </button>
                  </div>
                  <div className="flex gap-1">
                    <button
                      onClick={context.toggleSidebar}
                      className="px-2 py-1 text-xs rounded border hover:bg-muted"
                    >
                      Toggle Sidebar
                    </button>
                    <button
                      onClick={context.toggleFooter}
                      className="px-2 py-1 text-xs rounded border hover:bg-muted"
                    >
                      Toggle Footer
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      return (
        <LayoutProvider {...args}>
          <TestComponent />
        </LayoutProvider>
      );
    }}
  </Story>
</Canvas>

## Component API

<ArgsTable of={LayoutProvider} />

## Context Interface

### LayoutContextType

```typescript
interface LayoutContextType {
  variant: LayoutVariant;
  showSidebar: boolean;
  showFooter: boolean;
  subNavigation: NavItem[];
  setVariant: (variant: LayoutVariant) => void;
  toggleSidebar: () => void;
  toggleFooter: () => void;
}
```

### Available Hooks

| Hook | Return Type | Description |
|------|-------------|-------------|
| `useLayoutContext()` | `LayoutContextType` | Full layout context |
| `useLayoutVariant()` | `LayoutVariant` | Current layout variant |
| `useSidebarVisibility()` | `boolean` | Sidebar visibility state |
| `useFooterVisibility()` | `boolean` | Footer visibility state |
| `useLayoutSubNavigation()` | `NavItem[]` | Current sub-navigation |

## Error Boundary Features

The built-in error boundary provides:

- **Graceful Error Handling**: Catches layout-related errors without crashing the app
- **Fallback UI**: Shows a user-friendly error message with recovery options
- **Reload Functionality**: Provides a button to reload the page
- **Error Logging**: Logs errors to the console for debugging

## Best Practices

### Provider Placement

- Place at the application root for global layout control
- Use nested providers for section-specific layout configurations
- Wrap route groups that need consistent layout behavior

### State Management

- Layout state is local to each provider instance
- Use the navigation store for persistent sidebar state
- Leverage sub-navigation hook for route-based navigation

### Error Handling

- Always wrap layout providers with error boundaries
- Use the built-in LayoutProviderWithErrorBoundary for convenience
- Implement custom error handling for specific use cases

### Performance

- Layout context updates are optimized to prevent unnecessary re-renders
- Sub-navigation is memoized based on route changes
- Provider state changes only affect components that use the context
