import {
  Meta,
  Story,
  Canvas,
  ArgsTable,
  Description,
} from '@storybook/addon-docs';
import { GlobalNav } from './global-nav';
import { useAuthStore } from '@/stores/auth-store';
import { useLayoutStore } from '@/stores/ui/layout-store';

<Meta
  title="Layout Components/GlobalNav"
  component={GlobalNav}
  decorators={[
    (Story) => (
      <div className="flex min-h-[200px] items-center justify-center p-8 bg-background">
        <Story />
      </div>
    ),
  ]}
  parameters={{
    docs: {
      description: {
        component: `
The GlobalNav component displays the main navigation items for desktop and tablet views.
It provides intelligent filtering, active state management, and responsive behavior.

## Features

- Filters navigation items based on authentication state and feature flags
- Shows active state highlighting for current page
- Displays badges and tooltips for enhanced UX
- Handles external links with proper security attributes
- Responsive design with breakpoint awareness
- Configurable maximum items display
- Icon and badge display controls
- Keyboard navigation and accessibility support
- TypeScript support with strict typing

## Usage

Use GlobalNav for:

- Top navigation bars in desktop layouts
- Primary navigation in application headers
- Main menu systems with role-based filtering
- Responsive navigation that adapts to user state
- Feature-flag controlled navigation items
- Accessible navigation with screen reader support
  `
  }
  }
  }}
  argTypes={{
      maxItems: {
        control: { type: 'number', min: 1, max: 10 },
        description: 'Maximum number of navigation items to display',
        defaultValue: 6
      },
      showIcons: {
        control: { type: 'boolean' },
        description: 'Whether to show icons alongside navigation labels',
        defaultValue: false
      },
      showBadges: {
        control: { type: 'boolean' },
        description: 'Whether to show badges for navigation items',
        defaultValue: true
      },
      className: {
        control: { type: 'text' },
        description: 'Additional CSS classes to apply'
      }
    }}
  />

# GlobalNav

<Description of={GlobalNav} />

## Default Navigation

<Canvas>
  <Story name="Default">
    {() => (
      <div className="w-full space-y-4">
        <div className="text-muted-foreground text-sm">
          Standard navigation without icons:
        </div>
        <GlobalNav />
      </div>
    )}
  </Story>
</Canvas>

## With Icons

<Canvas>
  <Story name="With Icons">
    {() => (
      <div className="w-full space-y-4">
        <div className="text-muted-foreground text-sm">
          Navigation with icons alongside labels:
        </div>
        <GlobalNav showIcons />
      </div>
    )}
  </Story>
</Canvas>

## Without Badges

<Canvas>
  <Story name="Without Badges">
    {() => (
      <div className="w-full space-y-4">
        <div className="text-muted-foreground text-sm">
          Clean navigation without status badges:
        </div>
        <GlobalNav showBadges={false} />
      </div>
    )}
  </Story>
</Canvas>

## Limited Items

<Canvas>
  <Story name="Limited Items">
    {() => (
      <div className="space-y-6">
        <div>
          <div className="text-sm text-muted-foreground mb-2">Show only 3 items:</div>
          <GlobalNav maxItems={3} showIcons />
        </div>

        <div>
          <div className="text-sm text-muted-foreground mb-2">Show only 4 items:</div>
          <GlobalNav maxItems={4} showIcons />
        </div>
      </div>
    )}

  </Story>
</Canvas>

## Authenticated vs Unauthenticated

<Canvas>
  <Story name="Auth States">
    {() => {
      // Mock different auth states
      return (
        <div className="space-y-6">
          <div>
            <div className="text-sm text-muted-foreground mb-2">
              Unauthenticated user navigation:
            </div>
            <div className="border rounded-lg p-4">
              <GlobalNav showIcons />
            </div>
          </div>

          <div>
            <div className="text-sm text-muted-foreground mb-2">
              Authenticated user navigation:
            </div>
            <div className="border rounded-lg p-4">
              <GlobalNav showIcons />
            </div>
          </div>
        </div>
      );
    }}

  </Story>
</Canvas>

## Full Navigation Context

<Canvas>
  <Story name="Navigation Context">
    {() => (
      <div className="w-full">
        {/* Simulated top navigation */}
        <nav className="border-b bg-background/95 backdrop-blur">
          <div className="flex h-16 items-center justify-between px-6">
            <div className="flex items-center space-x-6">
              <div className="text-xl font-bold">Recipe App</div>
              <GlobalNav showIcons />
            </div>

            <div className="flex items-center space-x-4">
              <div className="h-8 w-8 rounded-full bg-muted" />
            </div>
          </div>
        </nav>
      </div>
    )}

  </Story>
</Canvas>

## Compact Navigation Layout

<Canvas>
  <Story name="Compact Layout">
    {() => (
      <div className="w-full">
        <nav className="bg-background border-b">
          <div className="flex h-12 items-center justify-between px-4">
            <div className="flex items-center space-x-4">
              <div className="text-lg font-semibold">App</div>
              <GlobalNav maxItems={4} />
            </div>
            <div className="bg-muted h-6 w-6 rounded-full" />
          </div>
        </nav>
      </div>
    )}
  </Story>
</Canvas>

## Active State Demo

<Canvas>
  <Story name="Active States">
    {() => {
      // Mock different active states
      return (
        <div className="space-y-6">
          <div className="text-sm text-muted-foreground">
            Navigation items show active state based on current route:
          </div>

          <div className="space-y-4">
            <div>
              <div className="text-xs text-muted-foreground mb-2">Home active:</div>
              <GlobalNav showIcons />
            </div>

            <div>
              <div className="text-xs text-muted-foreground mb-2">Recipes active:</div>
              <GlobalNav showIcons />
            </div>

            <div>
              <div className="text-xs text-muted-foreground mb-2">Collections active:</div>
              <GlobalNav showIcons />
            </div>
          </div>
        </div>
      );
    }}

  </Story>
</Canvas>

## Badge Variants Demo

<Canvas>
  <Story name="Badge Variants">
    {() => (
      <div className="space-y-4">
        <div className="text-sm text-muted-foreground">
          Different badge types and variants:
        </div>

        <div className="space-y-3">
          <div>
            <div className="text-xs text-muted-foreground mb-1">With status badges:</div>
            <GlobalNav showIcons showBadges />
          </div>

          <div>
            <div className="text-xs text-muted-foreground mb-1">Clean without badges:</div>
            <GlobalNav showIcons showBadges={false} />
          </div>
        </div>
      </div>
    )}

  </Story>
</Canvas>

## Disabled Items Demo

<Canvas>
  <Story name="Disabled Items">
    {() => (
      <div className="space-y-4">
        <div className="text-muted-foreground text-sm">
          Navigation with some disabled items:
        </div>
        <div className="text-muted-foreground text-xs">
          Note: Disabled items appear muted and are not clickable
        </div>
        <GlobalNav showIcons />
      </div>
    )}
  </Story>
</Canvas>

## External Links Demo

<Canvas>
  <Story name="External Links">
    {() => (
      <div className="space-y-4">
        <div className="text-muted-foreground text-sm">
          Navigation with external links (notice the external link icons):
        </div>
        <GlobalNav showIcons />
      </div>
    )}
  </Story>
</Canvas>

## Responsive Breakpoints

<Canvas>
  <Story name="Responsive Demo">
    {() => (
      <div className="space-y-6">
        <div className="text-sm text-muted-foreground">
          Navigation adapts to different screen sizes:
        </div>

        <div className="space-y-4">
          <div>
            <div className="text-xs text-muted-foreground mb-2">Desktop (> 1024px):</div>
            <div className="border rounded p-4">
              <GlobalNav showIcons maxItems={6} />
            </div>
          </div>

          <div>
            <div className="text-xs text-muted-foreground mb-2">Tablet (768px - 1024px):</div>
            <div className="max-w-2xl border rounded p-4">
              <GlobalNav showIcons maxItems={5} />
            </div>
          </div>

          <div>
            <div className="text-xs text-muted-foreground mb-2">Mobile Hidden (navigation would use drawer):</div>
            <div className="max-w-sm border rounded p-4 text-center text-muted-foreground">
              GlobalNav hidden on mobile - uses mobile drawer instead
            </div>
          </div>
        </div>
      </div>
    )}

  </Story>
</Canvas>

## Feature Flag Scenarios

<Canvas>
  <Story name="Feature Flags">
    {() => (
      <div className="space-y-6">
        <div className="text-sm text-muted-foreground">
          Navigation adapts based on feature flags:
        </div>

        <div className="space-y-4">
          <div>
            <div className="text-xs text-muted-foreground mb-2">Development mode (with demo components):</div>
            <GlobalNav showIcons />
          </div>

          <div>
            <div className="text-xs text-muted-foreground mb-2">Production mode (without demo):</div>
            <GlobalNav showIcons />
          </div>

          <div>
            <div className="text-xs text-muted-foreground mb-2">Limited features enabled:</div>
            <GlobalNav showIcons maxItems={4} />
          </div>
        </div>
      </div>
    )}

  </Story>
</Canvas>

## Custom Styling

<Canvas>
  <Story name="Custom Style">
    {() => (
      <div className="space-y-6">
        <div className="text-sm text-muted-foreground">Custom styling examples:</div>

        <div className="space-y-4">
          <div>
            <div className="text-xs text-muted-foreground mb-2">With background:</div>
            <GlobalNav className="bg-accent rounded-lg px-4 py-2" showIcons />
          </div>

          <div>
            <div className="text-xs text-muted-foreground mb-2">With border:</div>
            <GlobalNav className="border border-primary rounded-md px-3 py-1" showIcons />
          </div>

          <div>
            <div className="text-xs text-muted-foreground mb-2">Vertical layout:</div>
            <GlobalNav className="flex-col items-start space-x-0 space-y-1" showIcons maxItems={3} />
          </div>
        </div>
      </div>
    )}

  </Story>
</Canvas>

## Tooltip Demonstration

<Canvas>
  <Story name="Tooltips">
    {() => (
      <div className="space-y-4">
        <div className="text-muted-foreground text-sm">
          Hover over navigation items to see tooltips:
        </div>
        <GlobalNav showIcons />
        <div className="text-muted-foreground text-xs">
          Tooltips provide additional context for each navigation item
        </div>
      </div>
    )}
  </Story>
</Canvas>

## Dark Theme

<Canvas>
  <Story name="Dark Theme">
    {() => (
      <div className="dark">
        <div className="bg-background rounded-lg border p-6">
          <div className="space-y-4">
            <div className="text-foreground text-sm">
              Dark theme navigation:
            </div>
            <GlobalNav showIcons />
          </div>
        </div>
      </div>
    )}
  </Story>
</Canvas>

## Performance Demo

<Canvas>
  <Story name="Performance">
    {() => {
      const [renderCount, setRenderCount] = React.useState(0);

      React.useEffect(() => {
        setRenderCount(prev => prev + 1);
      });

      return (
        <div className="space-y-4">
          <div className="text-sm text-muted-foreground">
            Navigation with performance monitoring:
          </div>
          <GlobalNav showIcons />
          <div className="text-xs text-muted-foreground">
            Render count: {renderCount} (should be minimal)
          </div>
        </div>
      );
    }}

  </Story>
</Canvas>

## Interactive Example

<Canvas>
  <Story name="Interactive">
    {args => (
      <div className="w-full space-y-4">
        <div className="text-muted-foreground text-sm">
          Use the controls below to configure GlobalNav:
        </div>
        <GlobalNav {...args} />
      </div>
    )}
  </Story>
</Canvas>

## Component API

<ArgsTable of={GlobalNav} />

## Navigation Item Structure

### Standard Navigation Items

- **Home** - Main application dashboard
- **Recipes** - Recipe browsing and management
- **Collections** - Saved recipe collections
- **Meal Plans** - Meal planning features
- **Grocery Lists** - Shopping list management

### Authentication-Gated Items

- **My Recipes** - User's personal recipes (authenticated only)
- **Profile** - User profile settings (authenticated only)
- **Analytics** - Usage insights (premium/admin only)

### Development Items

- **Components** - UI component demo (development only)

## Badge System

### Badge Types

- **Status Badges**: Indicate feature status (New, Beta, Premium)
- **Count Badges**: Show numerical counts (notifications, items)
- **Warning Badges**: Highlight important information

### Badge Variants

- **Default**: Standard informational badges
- **Secondary**: Subtle status indicators
- **Destructive**: Error or warning states
- **Outline**: Minimal visual impact

## Accessibility Features

- **Keyboard Navigation**: Full keyboard support with proper tab order
- **Screen Reader Support**: Comprehensive ARIA labels and descriptions
- **Focus Management**: Clear focus indicators and logical navigation
- **Semantic HTML**: Proper navigation landmarks and menu roles
- **Active State Announcement**: Current page clearly indicated
- **External Link Indicators**: Visual and screen reader indicators

## Responsive Behavior

### Desktop (> 1024px)

- Full navigation with all items visible
- Tooltips enabled for additional context
- Icons and badges displayed
- Standard spacing and sizing

### Tablet (768px - 1024px)

- Condensed navigation with key items
- Reduced spacing for better fit
- Icons optional for space efficiency
- Tooltips still available

### Mobile (< 768px)

- Hidden in favor of mobile navigation drawer
- Replaced by hamburger menu system
- Space-efficient mobile-first approach

## Filtering Logic

### Authentication-Based Filtering

- Shows public items for unauthenticated users
- Adds personal items for authenticated users
- Includes admin/premium items based on user roles

### Feature Flag Integration

- Enables/disables features based on environment
- Shows development items in development mode
- Respects feature toggle configurations

### Platform-Specific Filtering

- Adapts to mobile vs desktop contexts
- Shows appropriate items for current platform
- Optimizes for available screen space

## Performance Considerations

### Optimization Strategies

- Memoized navigation item filtering
- Efficient re-render patterns
- Lazy loading for complex navigation items
- Minimal DOM updates on route changes

### Bundle Size

- Tree-shakeable navigation utilities
- Efficient icon loading
- Minimal dependencies

## Implementation Notes

- Integrates with Next.js routing for active state detection
- Uses authentication store for user-specific filtering
- Leverages layout store for responsive behavior
- Implements proper accessibility patterns throughout
- Type-safe with comprehensive TypeScript interfaces
- Follows design system conventions consistently
- Optimized for performance with proper memoization patterns
- Supports internationalization patterns for future expansion
